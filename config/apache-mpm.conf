# Apache MPM Event configuration optimized for Railway/Nextcloud
# Based on Nextcloud and Apache documentation recommendations

<IfModule mpm_event_module>
    # Thread configuration optimized for Railway containers
    StartServers             2
    MinSpareThreads         25
    MaxSpareThreads         75
    ThreadLimit             64
    ThreadsPerChild         25
    MaxRequestWorkers       150
    ThreadStackSize         1048576

    # Railway-specific tuning
    ServerLimit             16
    MaxConnectionsPerChild  1000

    # Performance settings
    ListenBacklog           511
    MaxKeepAliveRequests    100
    KeepAliveTimeout        5

    # Railway resource optimization
    MaxMemFree               2048
</IfModule>

# PHP-FPM proxy configuration for better performance
<FilesMatch \.php$>
    SetHandler "proxy:unix:/run/php/php8.3-fpm.sock|fcgi://localhost/"
</FilesMatch>

# Nextcloud-specific optimizations
<Directory /var/www/html>
    # Enable PHP processing
    php_value engine on

    # Nextcloud performance settings
    php_value apc.enable 1
    php_value apc.shm_size 256M
    php_value apc.ttl 7200
    php_value apc.gc_ttl 3600
    php_value apc.entries_hint 4096

    # OPcache settings
    php_value opcache.enable 1
    php_value opcache.memory_consumption 256
    php_value opcache.max_accelerated_files 10000
    php_value opcache.revalidate_freq 1
</Directory>
